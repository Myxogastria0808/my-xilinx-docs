---
sidebar_position: 1
---

# About

## この wiki について

**Vivado を CLI ツールとして使用するための非公式 Wiki です。**

Xilinx 社 の FPGA を使っていく上で、Vivado は切っても切り離せない存在ですが、正直言って Vivado の GUI は大分使いこなすのが難しいと感じていました。

そこで色々調べてみた結果、Vivado には batch mode というものが存在することを知り、これを使うことでコマンドラインから Vivado を動かすことができることを知りました。また、日本語の文献はあまり多くないためそもそも使っている人がそこまで多くないのかとも思います。そこでより多くの人が FPGA を触るモチベーションを高めるため、また使い勝手が良い batch mode を布教するためにこの Wiki を作成しました。

私は趣味で FPGA を触っている人間のため、間違いなどのご指摘がたくさんあるかと思います。

**何かご意見がありましたら、[X](https://x.com/whatacotton) か [github](https://github.com/WhatACotton/my-xilinx-docs) の [issue](https://github.com/WhatACotton/my-xilinx-docs/issues) にて教えてくださると幸いです。**

## 対象とする読者

- FPGA を少し触ったが、Vivado の GUI が複雑で挫折した人
- リモートで FPGA 開発をしてみたい人
- CLI から Vivado を使ってみたい人
- git でいい感じにコードを管理しながら Vivado で開発したい人

## 注意点

この Wiki はあくまでも Vivado を CLI のように使うための方法についての解説をしていますので、Vivado の GUI 的な使い方や、HDL の書き方については触れません。

また、この Wiki に沿って Vivado を使用した際に何らかの不利益があった場合でも、当方は一切の責任を負いませんので、自己責任で行ってくださるようお願いたします。

## FPGA の難点は git で管理することが難しい点

私が考えるに、FPGA 開発において一番ネックになってくるのがソース管理だと思います。ほとんどの人が別分野をある程度触ってから FPGA 開発を始めると思うのですが、web でも低レイヤでも、git などを用いたソース管理が簡単にできます。一方で Vivado などのプロプライエタリな EDA ツールを用いる FPGA 開発においては、プロジェクトごとに多くのフォルダが生成されるため、追跡しないといけないフォルダがかなり奥の階層にある場合が多く、ある程度の知識が必要になります。(難しくはなくとも簡単ではないと思います。)

## tcl という壁

batch mode を使うには tcl というスクリプト言語が使われます。この tcl、vivado を使うためには構文をまともに覚えなくても大丈夫なのですが、新しい言語を学ばないといけないと先入観に惑わされて食わず嫌いをしている人も少なからずいるのではないでしょうか。

## GUI からの解放

この Wiki がもたらす最大のメリットは**GUI からの解放**です。GUI から解放されるメリットとしては、

- **[SSH 越しで開発できる](#ssh越しで開発できる)**
- [RDP が最小限になる](#rdpが最小限になる)
- [コードエディタで最高の開発体験を得ることができる](#コードエディタで最高の開発体験を得ることができる)

これらが挙げられます。

### SSH 越しで開発できる

まず、SSH 越しで開発ができる様になるため開発機としてのクライアントを選ばなくなります。さらに SSH 先のホストに処理をさせることになるため、手元のクライアント側の OS の処理が重くなることはありません。

リモート開発ができないために手元の PC のスペックを上げないといけなかったり、スペックが高いデスクトップ PC を持っているのに出先での開発はスペックを抑えたノート PC でというケースも珍しくないと思います。さらに言えばコードの管理も端末間で取る必要が出てくるため、git を使っていない場合はファイルのコピー＆ペーストをせざるを得なくなり、結局バージョン管理が崩壊し、動いていたコードが行方不明になるというケースも多々あると思います。(少なくとも私は何回も経験しました。)

SSH 越しで開発ができる様になることで、ホスト PC でソースコードを一元管理することができます。

### RDP が最小限になる

SSH で開発をしない場合、RDP(Remote Desktop Protocol)を行なって開発することが多いかと思われます。RDP は良いソリューションだとは思いますが、通信量を大量に消費します。私の場合は、10 分くらいスマートフォンのテザリングをしただけでスマートフォンが発熱し、通信制限にかかりかけました。

RDP は通信環境が整った場所では問題ないと思われますが、通信環境が悪い場所ではやはり SSH が良いと思いますし、git で管理する場合はあらかじめ`clone`、`pull`しておくだけで、通信環境がない場所でも開発を行うことができます。また[Icarus Verilog](https://steveicarus.github.io/iverilog/)や[Verilator](https://verilator.org/guide/latest/)などの処理系を用いることで、Vivado を使わずともテストベンチを回すことができるため、どのクライアントにも数十 GB の Vivado を入れる必要もなくなります。ただしテストできるモジュールの規模は、ベンダー依存のモジュールを除く必要があるため、どうしても小規模にはなります。

最小限と表記している理由は、block design などのどうしても GUI を使わないといけない場面も少しはあるからです。しかし、block design さえもエクスポートが可能なため、最初に design を組み上げたらその先は必要ありません。最初から Vivado が入っている PC を使っていれば、その時だけ Vivado の GUI を開くだけです。

### コードエディタで最高の開発体験を得ることができる

FPGA 開発をする上で VSCode や Vim などの自分好みのエディタで開発している人が多いと思いますが、GUI を使用した開発を行なっていると、エディタと GUI を行き来することになります。

![reload](reload.png)

このボタンをいやになるほどにみてきた人も少なくないのではないでしょうか。このボタンは Vivado 外のエディタなどからファイルの変更があった場合に出るボタンで、このボタンを押すことで差分を吸収することができます。逆に言えばこのボタンを押さない限り実際に読み込まれるコードがどっちなのかわからないのです。

また独自 IP を開発している場合も同じです。IP Packager にて編集を行なった場合は、ファイルセットなどの更新後に Re-Package IP をし、組み上がっている Block Design の画面でも Update IP を行う必要があります。Update しない場合は、IP が前のバージョンで互換性を維持するためにロックがかかってしまいます。

これらは batch mode で実行することにより、コードも IP の更新もコードを読み込むところから始まるため、必要ありません。

**つまり大袈裟に言えば一文字変えて GUI ぽちぽちを繰り返すということが必要なくなるのです。**

さらにエディタの Linter や Formatter の支援を受けることにより、最高の開発体験を引き出すことができます。

## おすすめのスタンス

全て CLI で実行するのにはかなり無理があります。なのである程度の動作確認を GUI で行なってからソースコードを丸ごとプロジェクトとして移植するというスタンスが一番良いかと思われます。

3 割くらい実装が進んだところでおおまかなコードの構成が固まってきたところで移植することでその先の実装スピードを上げることができるのではないかと思います。
